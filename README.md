# ‚úçÔ∏è Textflowrhyme Infrastructure üê≥

## Terraform

- Use `task terraform:apply` to spin up a server on DigitalOcean. Save the server‚Äôs IP address to `ansible/inventory.yml`. The opposite of this command is `task terraform:destroy`.
- Don‚Äôt forget to create DigitalOcean PAT and save it to `terraform/.tfvars`:
  ```
  digitalocean_token = "dop_v1_..."
  ```

## Ansible

- Use `task ansible:install` to install Docker and Taskfile.
- This requires `terraform:apply`.


## Docker

- Use `task docker:restart` to run new versions of the services and prune the old ones.
- This requires `ansible:install`.
- Don‚Äôt forget to create `.env` first:
  ```
  # Postgres variables should be specified manually
  POSTGRES_USER=
  POSTGRES_PASSWORD=
  POSTGRES_DATABASE_FIEF=
  POSTGRES_DATABASE_BACKEND=
  # Traefik variables should also be specified manually
  DOMAIN=textflowrhy.me
  EMAIL=
  TRAEFIK_CERT_RESOLVER=letsencrypt  # leave empty when testing
  TRAEFIK_USER=
  TRAEFIK_PASSWORD_HASH='...'  # generated by `task generate-traefik-password`, should be kept in single quotes
  # Fief variables are generated by `task generate-fief-variables`
  FIEF_SECRET=
  FIEF_CLIENT_ID=
  FIEF_CLIENT_SECRET=
  FIEF_ENCRYPTION_KEY=
  FIEF_MAIN_USER_EMAIL=
  FIEF_MAIN_USER_PASSWORD=
  FIEF_EMAIL_PROVIDER_PARAMS={"server_token": "..."}
  FIEF_DEFAULT_FROM_EMAIL=service@textflowrhy.me
  FIEF_ALLOW_ORIGIN_REGEX=https://textflowrhy.me
  ```
