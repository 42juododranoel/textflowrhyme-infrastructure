# ‚úçÔ∏è Textflowrhyme Infrastructure üê≥

## Terraform

- Use `task terraform:apply` to spin up a server on DigitalOcean. Save the server‚Äôs IP address to `ansible/inventory.yml`. The opposite of this command is `task terraform:destroy`.
- Don‚Äôt forget to create DigitalOcean PAT and save it to `terraform/.tfvars`:
  ```
  digitalocean_token = "dop_v1_..."
  ```

## Ansible

- Use `task ansible:install` to install Docker and Taskfile.
- This requires `terraform:apply`.


## Docker

- Use `task docker:restart` to run new versions of the services and prune the old ones.
- This requires `ansible:install`.
- Don‚Äôt forget to create `.env` first:
  ```
  # Postgres variables should be specified manually
  POSTGRES_USER=
  POSTGRES_PASSWORD=
  POSTGRES_DATABASE_BACKEND=
  # Traefik variables should also be specified manually
  DOMAIN=textflowrhy.me
  TRAEFIK_EMAIL=
  TRAEFIK_CERT_RESOLVER=letsencrypt  # leave empty when testing
  TRAEFIK_USER=
  TRAEFIK_PASSWORD_HASH='...'  # generated by `task generate-traefik-password`, should be kept in single quotes
  ```
